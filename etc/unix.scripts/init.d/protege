#!/bin/bash

. /etc/default/protege
SERVER_DIR=${PROTEGE_SERVER_PREFIX}/server


start()
{
   if [ -f ${PID} ] 
   then
       echo Protege server is already running\?
       exit -1
   fi
   mkdir -p /var/log/protege
   chown ${PROTEGE_SANDBOX_USER} /var/log/protege
   cd ${SERVER_DIR}

   su ${PROTEGE_SANDBOX_USER} <<-END
     nohup \
       ${JAVA_CMD} \
         -Djava.awt.headless=true \
         -Xmx3G \
         -server -Djava.rmi.server.hostname=${HOSTNAME} \
         -DentityExpansionLimit=1000000 -Dfile.encoding=UTF-8 \
         -Dorg.protege.owl.server.configuration=metaproject.owl \
         -Djava.util.logging.config.file=logging-unix.properties \
         -classpath lib/felix.jar:lib/ProtegeLauncher.jar \
         org.protege.osgi.framework.Launcher &> /var/log/protege/cmdline &
     echo \$! > ${PID}
END
}

stop() 
{
    if [ ! -f ${PID} ]
    then
        echo Protege Server not running.
        exit 0
    fi
    kill -TERM `cat ${PID}`
    rm ${PID}
}


case "$1" in
start)
	start
	;;
stop)
    stop
    ;;
esac
